<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMMAR-Ai-Academy | المنصة المتكاملة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --brand: #6366f1; --accent: #10b981; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 160px; }
        
        /* الهيدر */
        header { background: white; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.4rem; font-weight: 800; color: var(--brand); }

        /* الأقسام */
        .nav-tabs { display: flex; justify-content: center; background: white; border-bottom: 1px solid #e2e8f0; }
        .tab-btn { padding: 12px 20px; border: none; background: none; cursor: pointer; font-weight: 600; color: #64748b; }
        .tab-btn.active { color: var(--brand); border-bottom: 3px solid var(--brand); }

        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }

        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); margin-bottom: 20px; }

        /* الشات */
        #chat-flow { display: flex; flex-direction: column; gap: 15px; min-height: 200px; }
        .bubble { padding: 12px 18px; border-radius: 15px; max-width: 85%; line-height: 1.6; font-size: 0.95rem; }
        .user-bubble { background: var(--brand); color: white; align-self: flex-start; }
        .ai-bubble { background: #f1f5f9; color: #1e293b; align-self: flex-end; border: 1px solid #e2e8f0; }

        /* الاقتراحات */
        .suggestions { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 15px; }
        .suggest-btn { background: #eef2ff; border: 1px solid #c7d2fe; color: var(--brand); padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 0.85rem; transition: 0.2s; }
        .suggest-btn:hover { background: var(--brand); color: white; }

        /* منطقة الرفع */
        .upload-area { border: 2px dashed #cbd5e1; padding: 20px; text-align: center; border-radius: 10px; cursor: pointer; }
        #preview-img { max-width: 100%; border-radius: 10px; margin-top: 10px; display: none; }

        /* شريط الإدخال */
        .bottom-bar { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }
        .input-group { max-width: 800px; margin: auto; display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        .send-btn { background: var(--brand); color: white; border: none; padding: 0 20px; border-radius: 8px; cursor: pointer; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<header>
    <div class="logo"><i class="fas fa-brain"></i> AMMAR-Ai Academy</div>
    <button onclick="exportToPDF()" style="background:#dc2626; color:white; border:none; padding:8px 15px; border-radius:6px; cursor:pointer;"><i class="fas fa-file-pdf"></i> PDF</button>
</header>

<nav class="nav-tabs">
    <button class="tab-btn active" onclick="showTab(event, 'chat-sec')">المساعد</button>
    <button class="tab-btn" onclick="showTab(event, 'files-sec')">المختبر</button>
    <button class="tab-btn" onclick="showTab(event, 'yt-sec')">فيديوهات</button>
</nav>

<div class="container" id="capture-area">
    <section id="chat-sec" class="section active">
        <div class="card">
            <input type="password" id="api-key" placeholder="أدخل مفتاح OpenRouter هنا..." style="width:100%; padding:10px; border-radius:6px; border:1px solid #ddd; margin-bottom:15px;">
            <div id="chat-flow">
                <div class="bubble ai-bubble">مرحباً بك! أنا مساعدك الذكي عبر OpenRouter. يمكنك الكتابة أو رفع صورة لتحليلها.</div>
            </div>
            <div class="suggestions" id="suggestion-box">
                <button class="suggest-btn" onclick="setQuery('اشرح لي قانون نيوتن الثالث')">قانون نيوتن</button>
                <button class="suggest-btn" onclick="setQuery('حل المسألة الرياضية في هذه الصورة')">حل مسألة من صورة</button>
                <button class="suggest-btn" onclick="setQuery('ما هي مكونات الخلية النباتية؟')">الخلية النباتية</button>
            </div>
        </div>
    </section>

    <section id="files-sec" class="section">
        <div class="card">
            <h3><i class="fas fa-upload"></i> رفع صورة للتحليل</h3>
            <div class="upload-area" onclick="document.getElementById('img-input').click()">
                <i class="fas fa-image fa-2x" style="color:#94a3b8"></i>
                <p>اضغط لاختيار صورة (مسألة، رسم هندسي، تجربة)</p>
                <input type="file" id="img-input" hidden accept="image/*">
            </div>
            <img id="preview-img" src="">
        </div>
    </section>

    <section id="yt-sec" class="section">
        <div class="card">
            <h3><i class="fab fa-youtube"></i> تجارب علمية</h3>
            <iframe width="100%" height="315" src="https://www.youtube.com/embed/videoseries?list=PLP67H_T5N8sE-XfL3l7XvHn937YvK6D_s" frameborder="0" allowfullscreen style="border-radius:10px;"></iframe>
        </div>
    </section>
</div>

<div class="bottom-bar">
    <div class="input-group">
        <input type="text" id="user-msg" placeholder="اكتب سؤالك هنا...">
        <button class="send-btn" id="send-btn"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<script>
    let currentBase64 = "";

    function showTab(e, id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        e.currentTarget.classList.add('active');
    }

    function setQuery(text) {
        document.getElementById('user-msg').value = text;
        if(text.includes('صورة')) showTab({currentTarget: document.querySelectorAll('.tab-btn')[1]}, 'files-sec');
    }

    // معالجة الصورة
    document.getElementById('img-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
            currentBase64 = event.target.result.split(',')[1];
            const p = document.getElementById('preview-img');
            p.src = event.target.result;
            p.style.display = 'block';
            alert("تم تحميل الصورة! اذهب لقسم المساعد واضغط إرسال");
        };
        reader.readAsDataURL(file);
    });

    // التواصل مع OpenRouter فقط
    async function talkToOpenRouter() {
        const msg = document.getElementById('user-msg').value;
        const key = document.getElementById('api-key').value;
        if(!msg || !key) return alert("المفتاح والرسالة مطلوبان!");

        appendMsg('user-bubble', msg);
        document.getElementById('user-msg').value = "";
        
        // تجهيز بيانات الطلب (Multi-modal)
        let content = [{ type: "text", text: msg }];
        if(currentBase64) {
            content.push({ type: "image_url", image_url: { url: `data:image/jpeg;base64,${currentBase64}` } });
        }

        try {
            const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${key}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "model": "google/gemini-2.0-flash-001", // الموديل الأفضل للرؤية والسرعة
                    "messages": [{ "role": "user", "content": content }]
                })
            });
            const data = await res.json();
            const reply = data.choices[0].message.content;
            appendMsg('ai-bubble', reply);
            
            // إعادة ضبط الصورة بعد النجاح
            currentBase64 = "";
            document.getElementById('preview-img').style.display = 'none';
        } catch (err) {
            appendMsg('ai-bubble', "حدث خطأ في الاتصال بـ OpenRouter. تأكد من المفتاح.");
        }
    }

    function appendMsg(cls, txt) {
        const div = document.createElement('div');
        div.className = `bubble ${cls}`;
        div.innerText = txt;
        document.getElementById('chat-flow').appendChild(div);
        div.scrollIntoView({ behavior: 'smooth' });
    }

    function exportToPDF() {
        const element = document.getElementById('capture-area');
        html2pdf().from(element).save('Ammar_Academy_Session.pdf');
    }

    document.getElementById('send-btn').addEventListener('click', talkToOpenRouter);
</script>

</body>
</html>
