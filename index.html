async function askOpenRouter(question, key) {
    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
        method: "POST",
        headers: {
            "Authorization": `Bearer ${key}`,
            "HTTP-Referer": window.location.href, // متطلب إضافي لبعض الموديلات في OpenRouter
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            "model": "google/gemini-2.0-flash-001", // جرب هذا الموديل الأحدث
            "messages": [{ "role": "user", "content": question }]
        })
    });

    const data = await response.json();
    if (data.error) {
        // إذا فشل الموديل الأول، جرب الموديل البديل تلقائياً
        console.log("التبديل للموديل البديل...");
        return await retryWithLlama(question, key);
    }
    return data.choices[0].message.content;
}

// دالة احتياطية في حال تعطل Gemini
async function retryWithLlama(question, key) {
    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
        method: "POST",
        headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
        body: JSON.stringify({
            "model": "meta-llama/llama-3.1-8b-instruct:free", 
            "messages": [{ "role": "user", "content": question }]
        })
    });
    const data = await response.json();
    return data.choices[0].message.content;
}
