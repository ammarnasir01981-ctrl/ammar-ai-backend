<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ø°ÙƒÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</title>
    <style>
        :root {
            --primary: #2E86C1;
            --secondary: #28B463;
            --bg: #f0f2f5;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; display: flex; flex-direction: column; height: 95vh; }
        
        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ */
        .api-settings { background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; gap: 10px; align-items: center; border: 2px solid var(--primary); }
        .api-settings input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
        .chat-box { flex: 1; background: white; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); display: flex; flex-direction: column; overflow: hidden; }
        #chat-history { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; background: #fafafa; }
        
        .message { padding: 12px 18px; border-radius: 15px; max-width: 85%; line-height: 1.6; font-size: 1rem; position: relative; word-wrap: break-word; }
        .user { align-self: flex-start; background: var(--primary); color: white; border-bottom-right-radius: 2px; }
        .ai { align-self: flex-end; background: #e9ecef; color: #333; border: 1px solid #dee2e6; border-bottom-left-radius: 2px; white-space: pre-wrap; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-area { padding: 20px; background: white; border-top: 1px solid #eee; display: flex; gap: 10px; }
        #user-input { flex: 1; padding: 12px; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; outline: none; transition: 0.3s; }
        #user-input:focus { border-color: var(--primary); }
        
        button { padding: 10px 25px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-send { background: var(--primary); color: white; }
        .btn-send:hover { background: #21618C; }
        .btn-send:disabled { background: #ccc; cursor: not-allowed; }
        
        .badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; margin-bottom: 5px; display: block; }
    </style>
</head>
<body>

<div class="container">
    <div class="api-settings">
        <label>ğŸ”‘ <strong>Ù…ÙØªØ§Ø­ Gemini:</strong></label>
        <input type="password" id="api-key-input" placeholder="Ø§Ù„ØµÙ‚ Ù…ÙØªØ§Ø­ API Ù‡Ù†Ø§ (AIza...)" autocomplete="off">
        <div style="font-size: 0.8rem; color: #666; max-width: 200px;">Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø· ÙˆÙ„Ù† ÙŠØªÙ… Ø­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±.</div>
    </div>

    <div class="chat-box">
        <div id="chat-history">
            <div class="message ai">
                <span class="badge" style="background:#ddd">Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Ù„ÙƒÙŠ Ø£Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ù…Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ù„ØµÙ‚ Ù…ÙØªØ§Ø­ Gemini API ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¹Ù„ÙˆÙŠØŒ Ø«Ù… Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø³Ø¤Ø§Ù„ ØªØ¹Ù„ÙŠÙ…ÙŠ.
            </div>
        </div>

        <div class="input-area">
            <input type="text" id="user-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§...">
            <button id="send-btn" class="btn-send">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>
</div>

<script>
    const chatHistory = document.getElementById('chat-history');
    const userInput = document.getElementById('user-input');
    const apiKeyInput = document.getElementById('api-key-input');
    const sendBtn = document.getElementById('send-btn');

    // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©
    function addMessage(role, text) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${role}`;
        const name = role === 'user' ? 'Ø£Ù†Øª' : 'Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ';
        const badgeColor = role === 'user' ? '#154360' : '#bdc3c7';
        
        msgDiv.innerHTML = `<span class="badge" style="background:${badgeColor}">${name}</span>${text}`;
        chatHistory.appendChild(msgDiv);
        chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¬ÙˆØ¬Ù„
    async function callGemini(question, apiKey) {
        const MODEL_NAME = "gemini-1.5-flash";
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`;
        
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: question }] }]
            })
        });

        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.error?.message || "ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…ÙØªØ§Ø­.");
        }
        
        return data.candidates[0].content.parts[0].text;
    }

    // Ø­Ø¯Ø« Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    sendBtn.addEventListener('click', async () => {
        const text = userInput.value.trim();
        const key = apiKeyInput.value.trim();

        if (!key) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ API Ø£ÙˆÙ„Ø§Ù‹ ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¹Ù„ÙˆÙŠ!");
            return;
        }
        if (!text) return;

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        addMessage('user', text);
        userInput.value = '';
        sendBtn.disabled = true;

        try {
            const aiResponse = await callGemini(text, key);
            addMessage('ai', aiResponse);
        } catch (error) {
            let errorMsg = "Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message;
            if (error.message.includes("location")) {
                errorMsg = "âŒ Ø®Ø·Ø£: Ù…Ù†Ø·Ù‚ØªÙƒ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ VPN (Ø£Ù…Ø±ÙŠÙƒØ§).";
            }
            addMessage('ai', errorMsg);
        } finally {
            sendBtn.disabled = false;
        }
    });

    userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendBtn.click(); });
</script>

</body>
</html>
